# Проект "CalcAPI" – распределённый вычислитель арифметических выражений ![Go](https://img.shields.io/badge/Go-1.20-blue.svg)

Добро пожаловать в репозиторий **yaLyceumFinal2**!  
Здесь реализован «распределённый калькулятор»:  
- **Оркестратор (сервер)**, который принимает арифметические выражения и «разбивает» их на задачи.  
- **Агент (клиент)**, который забирает у оркестратора задачи и выполняет их (имитируя длительные вычисления).

## :rocket: Основной функционал

1. **POST /api/v1/calculate** – добавление нового арифметического выражения  
   - Тело запроса:
     ```json
     {
       "expression": "2+2*2"
     }
     ```
   - Если всё корректно, сервер возвращает `201` и JSON с `{"id":"<uuid>"}`, где `<uuid>` – уникальный идентификатор выражения.
   - Если выражение содержит невалидные символы, вернётся `422 Unprocessable Entity`.

2. **GET /api/v1/expressions** – получение списка всех выражений  
   - Возвращает JSON вида:
     ```json
     {
       "expressions": [
         {
           "id": "<идентификатор>",
           "status": "<статус>",
           "result": <число или null>
         }
       ]
     }
     ```

3. **GET /api/v1/expressions/:id** – получение конкретного выражения  
   - Если существует – `200 OK` + JSON c `{"expression": {...}}`.
   - Если нет такого выражения – `404`.

4. **GET /internal/task** – получение задачи агентом  
   - Если есть готовая к выполнению задача – `200 OK` и JSON вида:
     ```json
     {
       "task": {
         "id": 1,
         "arg1": <число или строка>,
         "arg2": <число или строка>,
         "operation": <операция>,
         "operation_time": 3000
       }
     }
     ```
   - Если нет задач – `404`.

5. **POST /internal/task** – приём результата от агента  
   - Тело запроса:
     ```json
     {
       "id": 1,
       "result": 2.5
     }
     ```
   - Если всё ок – `200 OK` и `{"status":"ok"}`.  
   - Если нет такой задачи – `404`.  
   - Если поля некорректны (не int / float) – `422`.  

## :gear: Переменные окружения

- **TIME_ADDITION_MS** – время выполнения операции сложения (миллисекунды)
- **TIME_SUBTRACTION_MS** – время выполнения вычитания
- **TIME_MULTIPLICATIONS_MS** – время умножения
- **TIME_DIVISIONS_MS** – время деления
- **TIME_FULL_MS** – время вычисления «полного» выражения (при опции `operation=FULL`)
- **COMPUTING_POWER** – количество горутин у агента (для параллельных вычислений)

## :wrench: Как запустить оркестратор

1. Убедитесь, что установлен Go (версии 1.20+).  
2. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/TuHeKocmoc/yaLyceumFinal2.git
   ```
3. Перейдите в директорию:
  ```
  cd yaLyceumFinal2
  ```
4. Запустите оркестратор (сервер), выполнив:
  ```
  go run ./cmd/main.go
  ```
  По умолчанию он слушает порт 8080.

## :computer: Как запустить агента

1. 	В отдельном терминале (или на другой «машине»):
  ``` 
  cd yaLyceumFinal2 
  ```

2. Запустите:
  ```
  COMPUTING_POWER=2 go run ./cmd/agent/main.go
  ```

## :file_folder: Структура проекта

```
yaLyceumFinal2/
├── cmd/
│   ├── main.go         # Точка входа для "оркестратора"
│   └── agent/
│       └── main.go     # Точка входа для "агента"
├── internal/
│   ├── model/          # Определения структур (Expression, Task, статусы)
│   ├── repository/     # In-memory репозиторий (хранение Expression/Task)
│   ├── handler/        # HTTP-хендлеры (оркестратор)
│   └── calc/           # Старый модуль вычислений (Calc, Compute, ...)

├── EXAMPLE.md          # Примеры использования API
├── README.md           # Описание проекта (текущий файл)
└── go.mod              # Go-модуль
```